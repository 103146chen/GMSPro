<div id="view-system" class="view-section hidden max-w-7xl mx-auto space-y-6 pb-20">
    
    <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200 flex items-center justify-between">
         <div>
             <h3 class="font-bold text-slate-700 text-lg"><i class="fa-solid fa-gears mr-2"></i>系統設定</h3>
             <p class="text-xs text-slate-400">管理全域變數、資安金鑰與系統偏好設定。</p>
         </div>
         <div class="text-xs font-mono text-slate-300">v11.2 System Config</div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 animate-fade-in">

        <!-- 自動排程設定 -->
        <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 flex flex-col h-full lg:col-span-2">
            <div class="flex items-center gap-4 mb-4 border-b border-slate-100 pb-3">
                <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-pink-500 to-rose-600 text-white flex items-center justify-center text-xl shadow-md">
                    <i class="fa-solid fa-clock"></i>
                </div>
                <div>
                    <h3 class="font-bold text-slate-800 text-lg">自動排程設定</h3>
                    <p class="text-xs text-slate-500">設定系統自動執行的時間 (每天執行一次)。</p>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- 每日通知 -->
                <div class="flex flex-col space-y-2">
                    <div class="flex justify-between items-center">
                        <label class="font-bold text-slate-700 flex items-center">
                            <i class="fa-solid fa-bell mr-2 text-slate-400"></i> 每日自動化通知
                        </label>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="tg-auto-notify" class="sr-only peer">
                            <div class="w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-pink-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-pink-600"></div>
                        </label>
                    </div>
                    <p class="text-xs text-slate-400 mb-2">自動掃描並寄發缺交通知 (triggerDailyAutomation)</p>
                    <select id="sel-notify-hour" class="bg-slate-50 border border-slate-300 text-slate-900 text-sm rounded-lg focus:ring-pink-500 focus:border-pink-500 block w-full p-2.5">
                        <!-- JS 會填入 00:00 - 23:00 -->
                    </select>
                </div>

                <!-- 資料庫同步 -->
                <div class="flex flex-col space-y-2">
                    <div class="flex justify-between items-center">
                        <label class="font-bold text-slate-700 flex items-center">
                            <i class="fa-solid fa-database mr-2 text-slate-400"></i> 資料庫自動同步
                        </label>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="tg-auto-sync" class="sr-only peer">
                            <div class="w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                        </label>
                    </div>
                    <p class="text-xs text-slate-400 mb-2">自動彙整導師班級成績 (apiSyncToDatabase)</p>
                    <select id="sel-sync-hour" class="bg-slate-50 border border-slate-300 text-slate-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                    </select>
                </div>
            </div>
            
            <div class="mt-6 flex justify-end">
                 <button onclick="saveTriggerSettings()" id="btn-save-trigger" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-lg shadow-sm hover:shadow active:scale-95 transition-all text-sm flex items-center">
                    <i class="fa-solid fa-floppy-disk mr-2"></i> 儲存設定
                </button>
            </div>
        </div>
        
        <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 flex flex-col h-full">
            <div class="flex items-center gap-4 mb-4 border-b border-slate-100 pb-3">
                <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-indigo-500 to-purple-600 text-white flex items-center justify-center text-xl shadow-md">
                    <i class="fa-solid fa-shield-halved"></i>
                </div>
                <div>
                    <h3 class="font-bold text-slate-800 text-lg">系統金鑰 (Salt)</h3>
                    <p class="text-xs text-slate-500">加密核心，修改後需同步更新查詢端。</p>
                </div>
            </div>

            <div class="flex-1 flex flex-col justify-center space-y-4">
                <div>
                    <div class="relative">
                        <i class="fa-solid fa-key absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm"></i>
                        <input type="password" id="inp-sys-salt" class="w-full bg-slate-50 border border-slate-300 rounded-lg pl-9 pr-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 outline-none transition-all shadow-inner" placeholder="輸入新金鑰...">
                    </div>
                </div>
                
                <div class="flex items-center justify-between">
                    <div id="salt-status-msg" class="text-xs font-bold text-slate-400"></div>
                    <button onclick="saveSystemSalt()" id="btn-save-salt" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg shadow-sm hover:shadow-md active:scale-95 transition-all text-xs flex items-center">
                        <i class="fa-solid fa-floppy-disk mr-1"></i> 儲存
                    </button>
                </div>

                <div id="btn-copy-config" class="hidden mt-2 pt-3 border-t border-slate-100">
                    <button onclick="copyConfigForPortal()" class="w-full bg-slate-100 hover:bg-slate-200 text-slate-600 font-bold py-2 px-3 rounded-lg transition-all flex items-center justify-center gap-2 text-xs">
                        <i class="fa-solid fa-copy"></i> 複製查詢端設定代碼
                    </button>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 flex flex-col h-full">
            <div class="flex items-center gap-4 mb-4 border-b border-slate-100 pb-3">
                <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-amber-500 to-orange-600 text-white flex items-center justify-center text-xl shadow-md">
                    <i class="fa-solid fa-box-archive"></i>
                </div>
                <div>
                    <h3 class="font-bold text-slate-800 text-lg">學期資料封存</h3>
                    <p class="text-xs text-slate-500">新學期開始時使用，將舊資料移至歷史區。</p>
                </div>
            </div>

            <div class="bg-amber-50 border-l-4 border-amber-500 p-3 mb-4 flex-1">
                <ul class="list-disc list-inside text-xs text-amber-700 space-y-1">
                    <li>目前的 <code>DB_Source</code> 會改名為 <code>History_日期</code>。</li>
                    <li>封存後請記得執行「同步最新成績」。</li>
                    <li>學生帳密不會被清除。</li>
                </ul>
            </div>

            <div class="flex justify-end mt-auto">
                <button onclick="doArchive()" id="btn-archive" class="w-full bg-white border border-slate-300 hover:bg-slate-50 text-slate-700 font-bold py-2 px-4 rounded-lg shadow-sm active:scale-95 transition-all text-xs flex items-center justify-center">
                    <i class="fa-solid fa-box-open mr-2 text-amber-500"></i> 執行封存並重置
                </button>
            </div>

            <div class="mt-4 pt-3 border-t border-slate-100 text-center">
                <button onclick="doResetAuth()" class="text-[10px] text-slate-400 hover:text-red-500 hover:underline transition-colors flex items-center justify-center mx-auto">
                    <i class="fa-solid fa-triangle-exclamation mr-1"></i> 新學年重置 (清空所有帳號)
                </button>
            </div>
        </div>



        <div class="lg:col-span-2 bg-white rounded-xl shadow-sm border border-slate-200 p-6">
            <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                <div class="flex items-center gap-4">
                    <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-green-500 to-teal-600 text-white flex items-center justify-center text-xl shadow-md">
                        <i class="fa-solid fa-flask"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-slate-800 text-lg">測試資料生成</h3>
                        <p class="text-xs text-slate-500">自動建立含有 30 位學生與 5 項成績的測試試算表 (隨機缺交 10%)，並自動加入待處理清單。</p>
                    </div>
                </div>

                <button onclick="google.script.run.withSuccessHandler(function(res){ if(res.success){ alert('已建立測試資料：' + res.name); } else { alert('建立失敗：' + res.msg); } }).CreateMockData()" class="w-full md:w-auto bg-white border border-slate-300 hover:bg-green-50 text-slate-700 font-bold py-2 px-6 rounded-lg shadow-sm hover:shadow active:scale-95 transition-all flex items-center justify-center text-xs">
                    <i class="fa-solid fa-plus mr-2 text-green-500"></i> 建立測試資料
                </button>
            </div>
        </div>
    </div>
</div>