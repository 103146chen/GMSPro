# Change Log

> **System Overview**: 本系統由兩大核心專案並行運作：
> 1.  **GradeFlow**: 負責成績計算、資料庫管理、前端查詢介面 (Student Portal)。
> 2.  **AutomaticHomeworkNotifier**: 負責缺交掃描、排程監控、郵件通知發送。
>
> **Current Version:** v10.4

---

## v10.4 - 系統健康檢查 (System Health Check)
*針對兩大模組的底層邏輯進行效能優化與錯誤修復。*

### 🟢 [GradeFlow] 成績運算核心
- **迴圈邏輯反轉 (Loop Reversal)**：
  - 將運算邏輯從「逐一學生跑所有成績」修正為 **「逐一作業跑所有學生」**。
  - **效益**：確保記憶體在計算排名或平均時，同時只存在單一作業的數據，完全杜絕成績錯置 (Cross-contamination) 風險，並大幅提升運算速度。
- **UID 生成機制更新**：
  - 改用 `sheetName + "_" + columnIndex` 作為作業的唯一識別碼。
  - **效益**：解決不同分頁若有相同作業名稱（如：兩次段考都有「國文」）可能導致的 ID 衝突。

### 🔵 [Notifier] 通知與掃描
- **智能日期過濾 (Date Guard)**：
  - 新增 `startDate` 檢查機制。在掃描缺交時，會先驗證作業日期物件，避免將未來的作業或無效日期的欄位誤判為缺交。
- **發信錯誤處理 (Error Handling)**：
  - Email 發送功能新增 `try-catch` 機制。若 Gmail 配額不足或地址錯誤，系統會回傳具體錯誤訊息（如 `發送失敗：Error Message`），防止整個排程崩潰。

---

## v10.3 - 使用者體驗優化 (UX Update)

### 🟢 [GradeFlow] 前端查詢
- **五標視覺化**：將原本的進度條顯示改為清晰的「五標方塊」數值呈現 (Bg-slate-50 風格)。
- **自動登入 (Auto-login)**：
  - 新增 `localStorage` 機制，記住使用者的座號與密碼，避免重複輸入。
- **密碼規範更新**：
  - 學生預設：`student` + `{{座號補零}}`
  - 家長預設：`parent` + `{{座號補零}}`

---

## v9.1 - 資安架構升級 (Dual Auth)

### ⚙️ [System] 共同架構
- **資料庫分離 (DB Separation)**：
  - 將中繼資料庫拆分為兩個獨立分頁，提升安全性：
    - `DB_Source`：存放成績資料 JSON (由 GradeFlow 維護，每日覆寫)。
    - `DB_Auth`：存放權限與密碼表 (永久保存，保留用戶修改紀錄)。
- **雙重權限驗證**：
  - 實作「學生/家長」雙密碼機制，兩者權限獨立，避免學生修改密碼導致家長無法登入。

---

## v8.5 - 數據分析儀表板 (Analytics)

### 🟢 [GradeFlow] 數據中心
- **排行功能**：自動計算並顯示單科或總分的前三名 (🥇🥈🥉)。
- **成績分布圖**：新增五標 (頂/前/均/後/底) 的分布長條圖，快速掌握班級落點。
- **全班總覽**：新增視覺化圖表介面。

---

## v8.0 - 雙軌模式 (Dual Mode)

### 🟢 [GradeFlow] 模式切換
- **任課/導師模式**：
  - **任課模式 (Subject)**：藍色系主題，專注於單科成績管理。
  - **導師模式 (Homeroom)**：粉紫色系主題，整合全科成績與缺勤管理。
- **資料分流**：後端資料結構分離為 `subjectClasses` 與 `homeroomClasses`。

---

## v7.0 - 自動化流程 (The Creator)

### 🔵 [Notifier] 自動化建立
- **檔案建立器 (Creator)**：
  - 支援貼上 Excel 名單，批次建立多個班級的成績試算表。
  - 建立時可直接設定「公開連結」與「小老師 Email」。
- **連結管理中心**：新增 `View_Link` 頁面，集中管理所有外部試算表連結。

---

## v5.0 - 系統整合 (The Merger)
- **核心合併**：正式將獨立運作的「缺交通知機器人 (Notifier)」與「成績單產生器 (GradeFlow)」整合至單一 GAS 專案中，共用函式庫與設定檔。
- **UI 重構**：全面導入 Tailwind CSS，統一視覺風格。