<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GMSPro | 系統部署教學</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'Noto Sans TC', 'sans-serif'] },
                    colors: {
                        brand: { blue: '#2563EB', purple: '#9333EA', dark: '#0F172A' }
                    }
                }
            }
        }
    </script>
    <style>
        /* 核心佈局 */
        body { overflow: hidden; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        /* 面板切換動畫 */
        .step-panel { display: none; height: 100%; width: 100%; }
        .step-panel.active { display: flex; animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* 左側選單樣式 */
        .nav-group-header { cursor: pointer; transition: all 0.2s; }
        .nav-group-header:hover { background-color: #F8FAFC; }
        .nav-group-header.active { background-color: #EFF6FF; border-right: 3px solid #2563EB; }
        
        /* 子步驟清單動畫 */
        .nav-sub-list { 
            max-height: 0; overflow: hidden; transition: max-height 0.3s ease-in-out; 
        }
        .nav-sub-list.open { max-height: 1000px; }

        /* 子步驟項目 */
        .sub-item { 
            padding-left: 3.5rem; border-left: 2px solid #E2E8F0; 
            cursor: pointer; position: relative; transition: all 0.2s;
            color: #64748B; font-size: 0.85rem;
        }
        .sub-item:hover { color: #334155; }
        .sub-item.active { 
            color: #2563EB; font-weight: bold; border-left-color: #2563EB; background: #F8FAFC;
        }
        .sub-item.active::before {
            content: ''; position: absolute; left: -5px; top: 50%; transform: translateY(-50%);
            width: 8px; height: 8px; background: #2563EB; border-radius: 50%;
        }

        /* 點擊感應區 */
        .click-zone {
            position: absolute; top: 0; bottom: 0; width: 40%; z-index: 20; cursor: pointer;
            display: flex; align-items: center; opacity: 0; transition: opacity 0.2s;
        }
        .click-zone:hover { opacity: 1; }
        .click-zone.prev { left: 0; justify-content: flex-start; padding-left: 20px; background: linear-gradient(to right, rgba(0,0,0,0.05), transparent); }
        .click-zone.next { right: 0; justify-content: flex-end; padding-right: 20px; background: linear-gradient(to left, rgba(0,0,0,0.05), transparent); }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 antialiased h-screen flex flex-col">

    <nav class="bg-white border-b border-slate-200 z-50 flex-none h-14 shadow-sm">
        <div class="w-full px-4 h-full flex justify-between items-center">
            <div class="flex items-center gap-3">
                <a href="index.html" class="text-slate-500 hover:text-blue-600 transition flex items-center gap-1 text-sm font-bold border-r border-slate-200 pr-4">
                    <i class="fa-solid fa-arrow-left"></i> 首頁
                </a>
                <div class="bg-brand-blue text-white w-8 h-8 rounded-lg flex items-center justify-center font-bold text-lg">G</div>
                <span class="font-bold text-base tracking-tight text-slate-800 hidden md:block">GMSPro Deployment</span>
            </div>
            <div class="flex gap-3 text-sm font-medium text-slate-500">
                <span class="hidden md:inline text-xs bg-slate-100 px-2 py-1 rounded">
                    鍵盤操控：<kbd>←</kbd> 上一張 / <kbd>→</kbd> 下一張
                </span>
                <a href="https://github.com/103146chen/GMSPro" target="_blank" class="hover:text-slate-900 flex items-center gap-2 ml-4">
                    <i class="fa-brands fa-github"></i> GitHub
                </a>
            </div>
        </div>
    </nav>

    <div class="flex-1 flex overflow-hidden w-full">
        
        <aside class="w-72 bg-white border-r border-slate-200 flex flex-col z-10 shadow-lg flex-none hidden md:flex">
            <div class="p-4 border-b border-slate-100">
                <button onclick="jumpToVideo()" id="nav-video" class="w-full text-left px-3 py-2 rounded-lg flex items-center gap-3 hover:bg-red-50 transition group border border-transparent hover:border-red-100">
                    <div class="bg-red-100 text-red-600 w-8 h-8 rounded-full flex items-center justify-center group-hover:scale-110 transition">
                        <i class="fa-solid fa-play text-xs"></i>
                    </div>
                    <div>
                        <span class="block font-bold text-sm text-slate-700 group-hover:text-red-700">教學影片</span>
                        <span class="text-[10px] text-slate-400">Video Tutorial</span>
                    </div>
                </button>
            </div>

            <div id="sidebar-tree" class="flex-1 overflow-y-auto no-scrollbar py-2">
                </div>
            
            <div class="p-4 border-t border-slate-100 bg-slate-50">
                <a href="https://drive.google.com/drive/folders/1DcL7BAPT9ZesQbCIf2cYCUPsL65fen7u?usp=sharing" target="_blank" 
                   class="block w-full bg-slate-800 hover:bg-brand-blue text-white text-center py-2.5 rounded-lg font-bold text-xs transition shadow flex items-center justify-center gap-2">
                    <i class="fa-brands fa-google-drive"></i> 開啟雲端硬碟
                </a>
            </div>
        </aside>

        <main class="flex-1 bg-slate-900 h-full relative overflow-hidden flex flex-col">
            
            <div id="panel-video" class="step-panel w-full h-full bg-black relative flex flex-col">
                <div class="flex-1 relative">
                    <iframe class="w-full h-full absolute inset-0" src="https://www.youtube.com/embed/您的影片ID?rel=0" frameborder="0" allowfullscreen></iframe>
                </div>
                <div class="h-16 bg-slate-900 flex items-center justify-end px-6 border-t border-slate-800 flex-none">
                    <button onclick="jumpToStep(1, 0)" class="bg-brand-blue text-white px-5 py-2 rounded-full font-bold text-sm shadow-lg hover:bg-blue-600 transition flex items-center gap-2">
                        開始操作 Step 1 <i class="fa-solid fa-arrow-right"></i>
                    </button>
                </div>
            </div>

            <div id="panel-gallery" class="step-panel hidden w-full h-full flex-col lg:flex-row bg-slate-100">
                
                <div class="flex-1 relative bg-slate-200 overflow-hidden flex items-center justify-center group select-none">
                    
                    <div id="img-container" class="w-full h-full p-4 md:p-8 flex items-center justify-center">
                        <img id="active-image" src="" class="max-w-full max-h-full object-contain shadow-2xl rounded-lg bg-white transition-transform duration-300" alt="Tutorial Step">
                    </div>

                    <div class="click-zone prev group/prev" onclick="prevSlide()">
                        <div class="bg-white/80 text-slate-600 w-12 h-12 rounded-full flex items-center justify-center backdrop-blur shadow-lg group-hover/prev:scale-110 transition">
                            <i class="fa-solid fa-chevron-left text-lg"></i>
                        </div>
                    </div>
                    <div class="click-zone next group/next" onclick="nextSlide()">
                        <div class="bg-white/80 text-slate-600 w-12 h-12 rounded-full flex items-center justify-center backdrop-blur shadow-lg group-hover/next:scale-110 transition">
                            <i class="fa-solid fa-chevron-right text-lg"></i>
                        </div>
                    </div>
                </div>

                <div class="w-full lg:w-96 bg-white border-l border-slate-200 flex flex-col shadow-2xl z-20">
                    <div class="p-6 border-b border-slate-100 bg-slate-50 flex-none">
                        <div class="flex justify-between items-start mb-2">
                            <span id="info-badge" class="text-xs font-bold text-blue-600 uppercase tracking-widest bg-blue-100 px-2 py-1 rounded">Step 01</span>
                            <span id="info-counter" class="text-xs font-mono text-slate-400">1/3</span>
                        </div>
                        <h2 id="info-step-title" class="text-xl font-extrabold text-slate-800 leading-tight">建立檔案副本</h2>
                        
                        <div id="deploy-switcher" class="hidden mt-4 bg-slate-200 p-1 rounded-lg flex">
                            <button onclick="setDeployType('gf')" id="btn-gf" class="flex-1 py-1.5 text-xs font-bold rounded bg-white text-blue-700 shadow-sm transition">GradeFlow</button>
                            <button onclick="setDeployType('nt')" id="btn-nt" class="flex-1 py-1.5 text-xs font-bold rounded text-slate-500 hover:text-slate-700 transition">Notifier</button>
                        </div>
                    </div>

                    <div class="flex-1 p-6 overflow-y-auto">
                        <h3 id="info-img-title" class="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2">
                            Title Placeholder
                        </h3>
                        <div id="info-desc" class="text-slate-600 text-sm leading-relaxed whitespace-pre-line">
                            Description Placeholder...
                        </div>
                        
                        <div id="info-tip" class="mt-6 bg-amber-50 border border-amber-100 p-4 rounded-lg hidden">
                            <p class="text-xs text-amber-800 flex gap-2 items-start">
                                <i class="fa-solid fa-lightbulb mt-0.5 text-amber-500"></i>
                                <span id="info-tip-text">Tip content</span>
                            </p>
                        </div>
                    </div>

                    <div class="p-4 border-t border-slate-100 bg-slate-50 flex justify-between items-center flex-none">
                        <button onclick="prevSlide()" class="text-slate-400 hover:text-slate-700 font-bold text-sm px-4 py-2 flex items-center gap-2">
                            <i class="fa-solid fa-arrow-left"></i> 上一步
                        </button>
                        <button onclick="nextSlide()" class="bg-slate-900 text-white px-6 py-2 rounded-full font-bold text-sm hover:bg-brand-blue transition shadow-lg flex items-center gap-2">
                            下一步 <i class="fa-solid fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script>
        // --- 1. DATA CONFIGURATION ---
        const stepsConfig = [
            {
                id: 1,
                title: "建立檔案副本",
                icon: "fa-regular fa-copy",
                images: [
                    { src: "01.png", title: "進入 Google Drive", desc: "點擊連結進入公開資料夾。\n此時檔案是「唯讀」的，您無法編輯。", tip: "" },
                    { src: "02.png", title: "右鍵選單", desc: "在檔案上點擊「滑鼠右鍵」。\n選擇「建立副本 (Make a copy)」。", tip: "請勿直接雙擊開啟，那只是預覽模式。" },
                    { src: "03.png", title: "開啟新檔案", desc: "系統建立副本後，請回到您的雲端硬碟根目錄。\n找到並開啟剛剛建立的新檔案。", tip: "" }
                ]
            },
            {
                id: 2,
                title: "部署網頁",
                icon: "fa-solid fa-rocket",
                images: [
                    { src: "04.png", title: "開啟 Apps Script", desc: "開啟檔案後，您會看到程式碼編輯器。", tip: "" },
                    { src: "05.png", title: "點擊部署", desc: "點擊右上角的藍色「部署 (Deploy)」按鈕。", tip: "" },
                    { src: "06.png", title: "新增部署", desc: "選擇「新增部署作業 (New deployment)」。", tip: "" },
                    { 
                        src: "07-GradeFlow.png", // Dynamic
                        dynamic: true,
                        title: "設定權限 (重要)", 
                        desc: "請依照專案類型設定權限。", 
                        tip: "GradeFlow 務必設為 Anyone，家長才能看到。" 
                    },
                    { src: "08.png", title: "確認部署", desc: "設定完成後，點擊「部署」。", tip: "" }
                ]
            },
            {
                id: 3,
                title: "授予存取權",
                icon: "fa-solid fa-key",
                images: [
                    { src: "09.png", title: "開始授權", desc: "點擊「授予存取權 (Authorize access)」。", tip: "" },
                    { src: "10.png", title: "選擇帳號", desc: "選擇您的 Google 帳號。", tip: "" },
                    { src: "11.png", title: "進階設定", desc: "看到紅色警告是正常的。\n點擊左下角「Advanced (進階)」。", tip: "這是 Google 的標準安全機制。" },
                    { src: "12.png", title: "前往應用程式", desc: "點擊下方的「Go to ... (unsafe)」。", tip: "" },
                    { src: "13.png", title: "允許權限", desc: "點擊「Allow (允許)」。", tip: "" },
                    { src: "14.png", title: "複製網址", desc: "複製畫面上的「網頁應用程式網址」。", tip: "" },
                    { src: "15.png", title: "完成", desc: "點擊完成關閉視窗。", tip: "" }
                ]
            },
            {
                id: 4,
                title: "自動排程 (Notifier)",
                icon: "fa-regular fa-clock",
                images: [
                    { src: "16.png", title: "開啟觸發條件", desc: "點擊左側的鬧鐘圖示 (觸發條件)。", tip: "" },
                    { src: "17.png", title: "新增觸發", desc: "點擊右下角藍色按鈕「新增觸發條件」。", tip: "" },
                    { src: "18.png", title: "選擇函式", desc: "函式選擇 `triggerDailyAutomation`。", tip: "選錯函式機器人不會動喔！" },
                    { src: "19.png", title: "確認函式", desc: "再次確認是 `triggerDailyAutomation`。", tip: "" },
                    { src: "20.png", title: "活動來源", desc: "選擇「時間驅動 (Time-driven)」。", tip: "" },
                    { src: "21.png", title: "設定頻率", desc: "選擇「每日計時器」，時間建議設在放學後。", tip: "" },
                    { src: "22.png", title: "儲存", desc: "點擊儲存，完成設定！", tip: "" }
                ]
            }
        ];

        // --- 2. STATE ---
        let state = {
            stepIndex: 0, // 0-based index for stepsConfig
            imgIndex: 0,  // 0-based index for images inside a step
            deployType: 'gf' // 'gf' or 'nt'
        };

        // --- 3. INITIALIZATION ---
        function init() {
            renderSidebar();
            
            // Keyboard Nav
            document.addEventListener('keydown', (e) => {
                if(document.getElementById('panel-gallery').style.display !== 'none') {
                    if(e.key === 'ArrowRight') nextSlide();
                    if(e.key === 'ArrowLeft') prevSlide();
                }
            });
            
            // Show Video initially
            jumpToVideo();
        }

        // --- 4. RENDER SIDEBAR (Tree View) ---
        function renderSidebar() {
            const container = document.getElementById('sidebar-tree');
            container.innerHTML = ''; // Clear

            stepsConfig.forEach((step, idx) => {
                // Major Step Header
                const groupDiv = document.createElement('div');
                groupDiv.className = `nav-group`;
                
                const headerBtn = document.createElement('button');
                headerBtn.id = `nav-header-${idx}`;
                headerBtn.className = `nav-group-header w-full text-left px-4 py-3 flex items-center justify-between group border-b border-slate-50`;
                headerBtn.onclick = () => jumpToStep(idx + 1, 0); // 1-based step ID
                
                headerBtn.innerHTML = `
                    <div class="flex items-center gap-3">
                        <span class="w-6 h-6 rounded bg-slate-100 text-slate-500 flex items-center justify-center text-xs font-bold group-hover:bg-blue-100 group-hover:text-blue-600">${step.id}</span>
                        <span class="font-bold text-sm text-slate-700">${step.title}</span>
                    </div>
                    <i class="fa-solid fa-chevron-down text-xs text-slate-300 transition-transform duration-200" id="arrow-${idx}"></i>
                `;
                groupDiv.appendChild(headerBtn);

                // Sub-items List (Container)
                const subList = document.createElement('div');
                subList.id = `sublist-${idx}`;
                subList.className = `nav-sub-list bg-white`;
                
                step.images.forEach((img, imgIdx) => {
                    const subItem = document.createElement('div');
                    subItem.id = `subitem-${idx}-${imgIdx}`;
                    subItem.className = `sub-item py-2 pr-4 hover:bg-slate-50 block truncate`;
                    subItem.innerText = img.title;
                    subItem.onclick = (e) => {
                        e.stopPropagation();
                        jumpToStep(idx + 1, imgIdx);
                    };
                    subList.appendChild(subItem);
                });

                groupDiv.appendChild(subList);
                container.appendChild(groupDiv);
            });
        }

        // --- 5. NAVIGATION LOGIC ---
        
        function jumpToVideo() {
            document.getElementById('nav-video').classList.add('active'); // Video Btn Style
            // Reset Sidebar Highlights
            document.querySelectorAll('.nav-group-header').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.sub-item').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-sub-list').forEach(el => el.classList.remove('open'));
            
            document.getElementById('panel-video').style.display = 'flex';
            document.getElementById('panel-gallery').style.display = 'none';
        }

        function jumpToStep(stepId, imgIdx) {
            // Logic Index
            const sIdx = stepId - 1;
            state.stepIndex = sIdx;
            state.imgIndex = imgIdx;

            // UI Mode
            document.getElementById('nav-video').classList.remove('active');
            document.getElementById('panel-video').style.display = 'none';
            document.getElementById('panel-gallery').style.display = 'flex';
            document.getElementById('panel-gallery').classList.remove('hidden');

            updateSidebarUI();
            updateGalleryUI();
        }

        function nextSlide() {
            const currentStepConfig = stepsConfig[state.stepIndex];
            if (state.imgIndex < currentStepConfig.images.length - 1) {
                // Next Image in same step
                state.imgIndex++;
            } else {
                // Next Step
                if (state.stepIndex < stepsConfig.length - 1) {
                    state.stepIndex++;
                    state.imgIndex = 0;
                } else {
                    alert("恭喜！所有步驟已完成！");
                    return;
                }
            }
            updateSidebarUI();
            updateGalleryUI();
        }

        function prevSlide() {
            if (state.imgIndex > 0) {
                // Prev Image in same step
                state.imgIndex--;
            } else {
                // Prev Step
                if (state.stepIndex > 0) {
                    state.stepIndex--;
                    // Go to last image of prev step
                    state.imgIndex = stepsConfig[state.stepIndex].images.length - 1;
                } else {
                    // Back to Video
                    jumpToVideo();
                    return;
                }
            }
            updateSidebarUI();
            updateGalleryUI();
        }

        // --- 6. UI UPDATERS ---

        function updateSidebarUI() {
            // 1. Headers Highlighting
            document.querySelectorAll('.nav-group-header').forEach((el, idx) => {
                if (idx === state.stepIndex) {
                    el.classList.add('active');
                    document.getElementById(`arrow-${idx}`).style.transform = 'rotate(180deg)';
                } else {
                    el.classList.remove('active');
                    document.getElementById(`arrow-${idx}`).style.transform = 'rotate(0deg)';
                }
            });

            // 2. Sublists Expansion
            document.querySelectorAll('.nav-sub-list').forEach((el, idx) => {
                if (idx === state.stepIndex) el.classList.add('open');
                else el.classList.remove('open');
            });

            // 3. Subitem Highlighting
            document.querySelectorAll('.sub-item').forEach(el => el.classList.remove('active'));
            const activeSub = document.getElementById(`subitem-${state.stepIndex}-${state.imgIndex}`);
            if(activeSub) {
                activeSub.classList.add('active');
                activeSub.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }

        function updateGalleryUI() {
            const stepData = stepsConfig[state.stepIndex];
            const imgData = stepData.images[state.imgIndex];

            // Info Panel (Fixed ID to info-badge)
            document.getElementById('info-badge').innerText = `Step 0${state.stepIndex + 1}`;
            document.getElementById('info-counter').innerText = `${state.imgIndex + 1}/${stepData.images.length}`;
            document.getElementById('info-step-title').innerText = stepData.title;

            // Deploy Switcher Visibility (Only Step 2)
            const switcher = document.getElementById('deploy-switcher');
            if (state.stepIndex === 1) switcher.classList.remove('hidden'); // Step 2 is index 1
            else switcher.classList.add('hidden');

            // Image & Text Content
            let imgSrc = `Guide/images/${imgData.src}`;
            let descText = imgData.desc;

            // Handle Dynamic Content for Step 2
            if (imgData.dynamic) {
                if (state.deployType === 'gf') {
                    imgSrc = `Guide/images/07-GradeFlow.png`;
                    descText = "GradeFlow 設定：\n1. 執行身分：我 (Me)\n2. 誰可以存取：**任何人 (Anyone)**\n(家長需透過此權限存取)";
                } else {
                    imgSrc = `Guide/images/07-Notifier.png`;
                    descText = "Notifier 設定：\n1. 執行身分：我 (Me)\n2. 誰可以存取：**僅限本人 (Only Myself)**\n(保護後台安全)";
                }
            }

            // Update Image
            const imgEl = document.getElementById('active-image');
            imgEl.style.opacity = 0.5;
            setTimeout(() => {
                imgEl.src = imgSrc;
                imgEl.style.opacity = 1;
            }, 100);

            // Update Text
            document.getElementById('info-img-title').innerText = imgData.title;
            document.getElementById('info-desc').innerHTML = descText.replace(/\*\*(.*?)\*\*/g, '<strong class="text-blue-600">$1</strong>');
            
            // Tip
            const tipEl = document.getElementById('info-tip');
            if (imgData.tip) {
                tipEl.classList.remove('hidden');
                document.getElementById('info-tip-text').innerText = imgData.tip;
            } else {
                tipEl.classList.add('hidden');
            }
        }

        // Switch Deploy Type (GF/NT)
        function setDeployType(type) {
            state.deployType = type;
            const btnGf = document.getElementById('btn-gf');
            const btnNt = document.getElementById('btn-nt');

            if (type === 'gf') {
                btnGf.className = 'flex-1 py-1.5 text-xs font-bold rounded bg-white text-blue-700 shadow-sm transition';
                btnNt.className = 'flex-1 py-1.5 text-xs font-bold rounded text-slate-500 hover:text-slate-700 transition';
            } else {
                btnGf.className = 'flex-1 py-1.5 text-xs font-bold rounded text-slate-500 hover:text-slate-700 transition';
                btnNt.className = 'flex-1 py-1.5 text-xs font-bold rounded bg-white text-green-700 shadow-sm transition';
            }
            updateGalleryUI(); // Refresh current slide
        }

        // Start
        init();

    </script>
</body>
</html>